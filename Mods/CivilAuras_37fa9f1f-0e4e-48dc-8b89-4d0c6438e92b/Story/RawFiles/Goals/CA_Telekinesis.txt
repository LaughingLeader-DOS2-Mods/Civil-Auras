Version 1
SubGoalCombiner SGC_AND
INITSECTION
//DB_CA_TeleHand_Hands((CHARACTERGUID)NULL_00000000-0000-0000-0000-000000000000, (CHARACTERGUID)NULL_00000000-0000-0000-0000-000000000000, 0);
//DB_CA_TeleHand_Target((CHARACTERGUID)NULL_00000000-0000-0000-0000-000000000000, (GUIDSTRING)NULL_00000000-0000-0000-0000-000000000000, "");
//DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus)
//DB_CA_TeleHand_Target_Steal(_Hand, _Target)
//DB_CA_TeleHand_Target_Item(_Hand, _Target, _TimerName)
//DB_CA_TeleHand_Timers(_Hand, _TimerName, 0)
//DB_CA_TK_ActiveFX(_Player, _HandFX, _BeamFX);
KBSECTION
//REGION HELPERS
PROC
CA_TeleHand_ClearTarget((CHARACTERGUID)_Hand)
AND
DB_CA_TeleHand_Target_Steal(_Hand, _Target)
THEN
NOT DB_CA_TeleHand_Target_Steal(_Hand, _Target);

PROC
CA_TeleHand_ClearHands((CHARACTERGUID)_Player)
AND
DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus)
THEN
NOT DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus);

PROC
CA_TeleHand_TransferItems((CHARACTERGUID)_Hand)
AND
DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus)
THEN
TransferItemsToCharacter(_Hand, _Player);

PROC
CA_TeleHand_PickupItem((CHARACTERGUID)_Hand, (ITEMGUID)_Item)
AND
DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus)
AND
ItemIsContainer(_Item, 1)
THEN
CharacterUseItem(_Hand, _Item, "");

PROC
CA_TeleHand_PickupItem((CHARACTERGUID)_Hand, (ITEMGUID)_Item)
AND
DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus)
AND
ItemIsContainer(_Item, 0)
THEN
ItemToInventory(_Item, _Player);
//REGION

//REGION FX
PROC
CA_TeleHand_Setup((CHARACTERGUID)_Player, (CHARACTERGUID)_Hand)
AND
CharacterGetAbility(_Player, "Thievery", _Bonus)
THEN
ApplyStatus(_Hand, "CA_TELEHAND_PASSIVE", 30.0, 1);
ApplyStatus(_Hand, "SNEAKING", -1.0, 1);
CharacterAddAbility(_Hand, "Thievery", _Bonus);
//CharacterAddToPlayerCharacter(_Hand, _Player);
DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus);
//CharacterAddToParty(_Hand, _Player);
CharacterDetachFromGroup(_Hand);
CharacterStopFollow(_Player);
CharacterStopFollow(_Hand);
MakePlayerActive(_Hand);
//NOT DB_Following(_Hand,_Player);
////IsSummonOrPartyFollower

PROC CA_TeleHand_PlayerAnimation((CHARACTERGUID)_Player)
THEN
CharacterSetAnimationOverride(_Player, "skill_prepare_touch_01_loop");

PROC
CA_TeleHand_PlayerEffects((CHARACTERGUID)_Player, (CHARACTERGUID)_Hand)
AND
PlayLoopEffect(_Player, "RS3_FX_GP_CC_Telekinesis_HandFX_01", "Dummy_L_HandFX", _HandFX)
AND
PlayLoopBeamEffect(_Player, _Hand, "RS3_FX_GP_Beams_Telekinesis_01", "Dummy_L_HandFX", "Dummy_Pos_001", _BeamFX)
AND
GetUUID(_Player, _Pstr)
AND
StringConcatenate("CA_AnimTimer_", _Pstr, _TimerName)
THEN
ApplyStatus(_Player, "CA_CHANNELING", 30.0, 1);
CA_TeleHand_PlayerAnimation(_Player);
DB_CA_TK_ActiveFX(_Player, _HandFX, _BeamFX, _TimerName);
//TimerLaunch(_TimerName, 500);

PROC
CA_TeleHand_ResetEffects((CHARACTERGUID)_Hand)
AND
DB_CA_TeleHand_Hands(_Player, _Hand, _)
AND
DB_CA_TK_ActiveFX(_Player, _HandFX, _BeamFX, _TimerName)
THEN
RemoveStatus(_Player, "CA_CHANNELING");
StopLoopEffect(_HandFX);
StopLoopEffect(_BeamFX);
CharacterSetAnimationOverride(_Player, "idle1");
TimerCancel(_TimerName);
NOT DB_CA_TK_ActiveFX(_Player, _HandFX, _BeamFX, _TimerName);

/*
IF
TimerFinished(_TimerName)
AND
DB_CA_TK_ActiveFX(_Player, _HandFX, _BeamFX, _TimerName)
AND
HasActiveStatus(_Player, "CA_CHANNELING", 1)
THEN
CA_TeleHand_PlayerAnimation(_Player);
*/

//END_REGION


//REGION STEAL
IF
CharacterUsedSkillOnTarget(_Player, (CHARACTERGUID)_Target, "Target_CA_TeleHand", _)
AND
DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus)
AND
CharacterGetDisplayName(_Player, _Handle, _Ref)
AND
StringConcatenate(_Handle, _Ref, _Name)
AND
StringConcatenate("CA_TeleHand_Timer_", _Name, _TimerName)
AND
NOT DB_CA_TeleHand_Timers(_Hand, _TimerName)
AND
NOT DB_CA_TeleHand_Target_Steal(_Hand, _Target)
THEN
Foop(_Hand);
CharacterRemoveAbility(_Hand, "Thievery", _Bonus);
NOT DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus);
CA_TeleHand_Setup(_Player, _Hand);
CA_TeleHand_PlayerEffects(_Player, _Hand);
DB_CA_TeleHand_Target_Steal(_Hand, _Target);
DB_CA_TeleHand_Timers(_Hand, _TimerName, 0);
TimerLaunch(_TimerName, 250);

IF
CharacterUsedSkillOnTarget(_Player, (CHARACTERGUID)_Target, "Target_CA_TeleHand", _)
AND
NOT DB_CA_TeleHand_Hands(_Player, _, _)
AND
GetPosition(_Player, _x,_y,_z)
AND
CharacterCreateAtPosition(_x, _y, _z, "CA_Summon_TeleHand_0547138c-21c0-4dbe-9c2a-97450ec82dd7", 1, _Hand)
AND
CharacterGetDisplayName(_Player, _Handle, _Ref)
AND
StringConcatenate(_Handle, _Ref, _Name)
AND
StringConcatenate("CA_TeleHand_Timer_", _Name, _TimerName)
AND
NOT DB_CA_TeleHand_Timers(_Hand, _TimerName)
AND
NOT DB_CA_TeleHand_Target_Steal(_Hand, _Target)
THEN
CA_TeleHand_Setup(_Player, _Hand);
CA_TeleHand_PlayerEffects(_Player, _Hand);
DB_CA_TeleHand_Target_Steal(_Hand, _Target);
DB_CA_TeleHand_Timers(_Hand, _TimerName, 0);
TimerLaunch(_TimerName, 250);

IF
TimerFinished(_TimerName)
AND
DB_CA_TeleHand_Timers(_Hand, _TimerName, 1)
AND
DB_CA_TeleHand_Target_Steal(_Hand, _Target)
THEN
StartPickpocket(_Hand, _Target, 1);
TimerCancel(_TimerName);
NOT DB_CA_TeleHand_Timers(_Hand, _TimerName, 1);

IF
TimerFinished(_TimerName)
AND
DB_CA_TeleHand_Timers(_Hand, _TimerName, 0)
AND
DB_CA_TeleHand_Target_Steal(_Hand, _Target)
THEN
TeleportTo(_Hand, _Target);
TimerCancel(_TimerName);
TimerLaunch(_TimerName, 250);
NOT DB_CA_TeleHand_Timers(_Hand, _TimerName, 0);
DB_CA_TeleHand_Timers(_Hand, _TimerName, 1);

IF
CharacterPickpocketSuccess(_Hand, _Target, _Item, _Amount)
AND
DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus)
THEN
//TransferItemsToCharacter(_Hand, _Player);
ItemToInventory(_Item, _Player);

IF
CharacterPickpocketFailed(_Hand, _Target)
AND
DB_CA_TeleHand_Target_Steal(_Hand, _Target)
THEN
CharacterUseSkill(_Hand, "Shout_CA_TeleHand_Dismiss", _Hand);
//END_REGION

/*
//REGION ITEM
IF
CharacterUsedSkillOnTarget(_Player, (ITEMGUID)_Target, "Target_CA_TeleHand", _)
AND
DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus)
AND
CharacterGetAbility(_Player, "Thievery", _ThieveryVal)
AND
CharacterGetAbility(_Hand, "Thievery", _HandVal)
AND
CharacterGetDisplayName(_Player, _Handle, _Ref)
AND
StringConcatenate(_Handle, _Ref, _Name)
AND
StringConcatenate("CA_TeleHand_Timer_", _Name, _TimerName)
AND
NOT DB_CA_TeleHand_Target_Item(_Hand, _Target, _TimerName)
THEN
CharacterRemoveAbility(_Hand, "Thievery", _Bonus);
CharacterAddAbility(_Hand, "Thievery", _ThieveryVal);
NOT DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus);
DB_CA_TeleHand_Hands(_Player, _Hand, _ThieveryVal);
CharacterAddToParty(_Hand, _Player);
MakePlayerActive(_Hand);
CharacterAddToPlayerCharacter(_Hand, _Player);
TeleportTo(_Hand, _Target);
CA_TeleHand_ClearTarget(_Hand);
DB_CA_TeleHand_Target_Item(_Hand, _Target, _TimerName);
TimerLaunch(_TimerName, 500);

IF
CharacterUsedSkillOnTarget(_Player, (ITEMGUID)_Target, "Target_CA_TeleHand", _)
AND
NOT DB_CA_TeleHand_Hands(_Player, _, _)
AND
CharacterGetAbility(_Player, "Thievery", _ThieveryVal)
AND
GetPosition(_Player, _x,_y,_z)
AND
CharacterCreateAtPosition(_x, _y, _z, "CA_Summon_TeleHand_0547138c-21c0-4dbe-9c2a-97450ec82dd7", 1, _Hand)
AND
CharacterGetDisplayName(_Player, _Handle, _Ref)
AND
StringConcatenate(_Handle, _Ref, _Name)
AND
StringConcatenate("CA_TeleHand_Timer_", _Name, _TimerName)
AND
NOT DB_CA_TeleHand_Target_Item(_Hand, _Target, _TimerName)
THEN
CharacterAddAbility(_Hand, "Thievery", _ThieveryVal);
CharacterMakePlayer(_Hand);
CharacterAddToParty(_Hand, _Player);
MakePlayerActive(_Hand);
CharacterAddToPlayerCharacter(_Hand, _Player);
TeleportTo(_Hand, _Target);
DB_CA_TeleHand_Hands(_Player, _Hand, _ThieveryVal);
DB_CA_TeleHand_Target_Item(_Hand, _Target, _TimerName);
TimerLaunch(_TimerName, 500);

IF
TimerFinished(_TimerName)
AND
DB_CA_TeleHand_Target_Item(_Hand, _Target, _TimerName)
AND
ObjectIsItem(_Target, 1)
THEN
CA_TeleHand_PickupItem(_Hand, _Target);
TimerCancel(_TimerName);

IF
TimerFinished(_TimerName)
AND
DB_CA_TeleHand_Target_Item(_Hand, _Target, _TimerName)
AND
ObjectIsCharacter(_Target, 0)
AND
ObjectIsItem(_Target, 0)
THEN
TimerCancel(_TimerName);

//END_REGION
*/

PROC
CA_TeleHand_RemoveHand(CHARACTERGUID)_Hand)
AND
ObjectIsOnStage(_Hand, 1)
THEN
CA_TeleHand_ResetEffects(_Hand);
CharacterStatusText(_Hand, "Dismissing TeleHand...");
//RemoveStatus(_Hand, "CA_TELEHAND_PASSIVE");
CharacterRemoveFromParty(_Hand);
CA_TeleHand_TransferItems(_Hand);
CA_TeleHand_ClearTarget(_Hand);
Poof(_Hand);
//CharacterDie(_Hand, 0, "None");

IF
CharacterStatusRemoved(_Player, "CA_CHANNELING", _)
AND
DB_CA_TeleHand_Hands(_Player, _Hand, _Bonus)
AND
DB_CA_TK_ActiveFX(_Player, _HandFX, _BeamFX, _TimerName)
THEN
CA_TeleHand_RemoveHand(_Hand);

IF
CharacterStatusRemoved(_Hand, "CA_TELEHAND_PASSIVE", _)
AND
GetTemplate(_Hand, _Template)
AND
_Template == "CA_Summon_TeleHand_0547138c-21c0-4dbe-9c2a-97450ec82dd7"
THEN
CA_TeleHand_RemoveHand(_Hand);

IF
CharacterUsedSkill(_Hand, "Shout_CA_TeleHand_Dismiss", _)
AND
GetTemplate(_Hand, _Template)
AND
_Template == "CA_Summon_TeleHand_0547138c-21c0-4dbe-9c2a-97450ec82dd7"
THEN
CA_TeleHand_RemoveHand(_Hand);
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ZZZ_CivilAuras"
