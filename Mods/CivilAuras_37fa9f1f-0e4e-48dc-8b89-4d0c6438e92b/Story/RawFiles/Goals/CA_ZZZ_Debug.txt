Version 1
SubGoalCombiner SGC_AND
INITSECTION
//DB_CA_TestDummy((CHARACTERGUID)S_Player_TestGareth_000_ff106095-41b6-419e-9663-db1cac2e39bd);
//DB_CA_TestDummy((CHARACTERGUID)S_Player_TestBeast_000_977b5ea9-86ce-48d4-a36e-7cbeaf15a422);
//DB_CA_TestDummy((CHARACTERGUID)S_Player_TestPlayer_ab423237-5f34-48b9-be48-11fc9e32a9c6);

//DB_Debug_PreviousEquipment(_Player, _Slot, _Item);

//REGION Equipment Slots
DB_Debug_Slots("Weapon");
DB_Debug_Slots("Shield");
DB_Debug_Slots("Helmet");
DB_Debug_Slots("Breast");
DB_Debug_Slots("Leggings");
DB_Debug_Slots("Ring");
DB_Debug_Slots("Belt");
DB_Debug_Slots("Boots");
DB_Debug_Slots("Gloves");
DB_Debug_Slots("Amulet");
DB_Debug_Slots("Ring2");
//DB_Debug_Slots("Wings");
//DB_Debug_Slots("Horns");
//DB_Debug_Slots("Overhead");
//END_REGION
KBSECTION
//REGION FLAGS
PROC
CA_Settings_Debug_TraceFlag((CHARACTERGUID)_Player, (STRING)_FlagName, (INTEGER)_FlagValue)
AND
IntegertoString(_FlagValue, _FlagVal)
AND
StringConcatenate(_FlagName, " = ", _Part1)
AND
StringConcatenate(_Part1, _FlagVal, _Message)
THEN
CharacterStatusText(_Player, _Message);

IF
ObjectFlagSet(_Flag, (CHARACTERGUID)_Player, _Instance)
AND
GlobalGetFlag("CA_DEBUG_DISPLAYFLAGS", 1)
AND
ObjectGetFlag(_Player, _Flag, _Val)
THEN
CA_Settings_Debug_TraceFlag(_Player, _Flag, _Val);

IF
ObjectFlagCleared(_Flag, (CHARACTERGUID)_Player, _Instance)
AND
GlobalGetFlag("CA_DEBUG_DISPLAYFLAGS", 1)
AND
ObjectGetFlag(_Player, _Flag, _Val)
THEN
CA_Settings_Debug_TraceFlag(_Player, _Flag, _Val);

IF
GlobalFlagSet(_Flag)
AND
GlobalGetFlag("CA_DEBUG_DISPLAYFLAGS", 1)
AND
GlobalGetFlag(_Flag, _Val)
AND
DB_IsPlayer(_Player)
THEN
CA_Settings_Debug_TraceFlag(_Player, _Flag, _Val);

IF
GlobalFlagCleared(_Flag)
AND
GlobalGetFlag("CA_DEBUG_DISPLAYFLAGS", 1)
AND
GlobalGetFlag(_Flag, _Val)
AND
DB_IsPlayer(_Player)
THEN
CA_Settings_Debug_TraceFlag(_Player, _Flag, _Val);


//END_REGION

//REGION AURA_OFF
PROC
CA_Debug_TurnOffAuras()
AND
DB_IsPlayer(_Player)
THEN
CA_Luck_TurnAuraOff(_Player);
CA_Stealth_TurnAuraOff(_Player);
CA_RemoveMotivated(_Player);
SetStoryEvent(_Player, "Event_CA_Bartering_TradeEnded");
CharacterStatusText(_Player, "[DEBUG] Disabling auras before removing bonus points.");

//END_REGION

//REGION BONUS POINTS
PROC
CA_Debug_ClearSavedEquipment((CHARACTERGUID)_Player)
AND
DB_Debug_PreviousEquipment(_Player, _Slot, _Item)
THEN
NOT DB_Debug_PreviousEquipment(_Player, _Slot, _Item);

PROC
CA_Debug_UnequipAll((CHARACTERGUID)_Player)
AND
DB_Debug_Slots(_Slot)
AND
CharacterGetEquippedItem(_Player, _Slot, (ITEMGUID)_Item)
THEN
CharacterUnequipItem(_Player, _Item);
DB_Debug_PreviousEquipment(_Player, _Slot, _Item);

PROC
CA_Debug_EquipAllPrevious((CHARACTERGUID)_Player)
AND
DB_Debug_PreviousEquipment(_Player, _Slot, _Item)
AND
ItemIsInCharacterInventory(_Item, _Player, 1)
THEN
CharacterEquipItem(_Player, _Item);
NOT DB_Debug_PreviousEquipment(_Player, _Slot, _Item);


PROC
CA_Debug_RemoveBonusPoints((CHARACTERGUID)_Player, (STRING)_StatName)
AND
CharacterGetBaseAbility(_Player, _StatName, _BaseValue)
AND
_BaseValue > 0
AND
CharacterGetAbility(_Player, _StatName, _BonusValue)
AND
IntegerSubtract(_BonusValue, _BonusValue, _Extra)
AND
IntegertoString(_BonusValue, _ExtraStr)
AND
StringConcatenate("[DEBUG] Removed ", _ExtraStr, _Str1)
AND
StringConcatenate(_Str1, "points from ", _Str2)
AND
StringConcatenate(_Str2, _StatName, _Message)
THEN
CharacterRemoveAbility(_Player, _StatName, _Extra);
CharacterStatusText(_Player, _Message);

IF
ObjectFlagSet("CA_DEBUG_REMOVEBONUSPOINTS", (CHARACTERGUID)_Player, _Instance)
AND
GetUUID(_Player, _Name)
AND
StringConcatenate("CA_Timer_Debug_RemovePoints_", _Name, _TimerName)
THEN
CA_Debug_TurnOffAuras();
CA_Debug_ClearSavedEquipment(_Player);
CA_Debug_UnequipAll(_Player);
TimerLaunch(_TimerName, 1000);
DB_Debug_Timers(_Player, _TimerName);

IF
TimerFinished(_TimerName)
AND
DB_Debug_Timers(_Player, _TimerName)
THEN
CA_Debug_RemoveBonusPoints(_Player, "Luck");
CA_Debug_RemoveBonusPoints(_Player, "Sneaking");
CA_Debug_RemoveBonusPoints(_Player, "Persuasion");
CA_Debug_RemoveBonusPoints(_Player, "Barter");
CharacterStatusText(_Player, "[DEBUG] Bonus points removal complete.");
NOT DB_Debug_Timers(_Player, _TimerName);
ObjectClearFlag(_Player, "CA_DEBUG_REMOVEBONUSPOINTS");
CA_Debug_EquipAllPrevious(_Player);
//END_REGION

//REGION HELPER_METHODS
PROC
CA_Debug_RemoveAuras((CHARACTERGUID)_Player)
AND
DB_CA_Aura_AuraStatus(_Index, _Stat, _HostStatus, _AuraStatus, _BonusStatus)
AND
HasActiveStatus(_Player, _HostStatus, 1)
THEN
RemoveStatus(_Player, _HostStatus);

PROC
CA_Debug_RemoveAuras((CHARACTERGUID)_Player)
AND
DB_CA_Aura_AuraStatus(_Index, _Stat, _HostStatus, _AuraStatus, _BonusStatus)
AND
HasActiveStatus(_Player, _AuraStatus, 1)
THEN
RemoveStatus(_Player, _AuraStatus);

PROC
CA_Debug_RemoveBonuses((CHARACTERGUID)_Player)
AND
DB_CA_Aura_AuraStatus(_Index, _Stat, _HostStatus, _AuraStatus, _BonusStatus)
AND
HasActiveStatus(_Player, _BonusStatus, 1)
THEN
RemoveStatus(_Player, _BonusStatus);
//END_REGION

//REGION PRINTING
QRY
CA_QRY_Debug_Print_All((STRING)_Str1)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Str1);

QRY
CA_QRY_Debug_Print_All((STRING)_Str1, (STRING)_Str2)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Str1, _Str2);

QRY
CA_QRY_Debug_Print_All((STRING)_Str1, (STRING)_Str2, (STRING)_Str3)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3);

QRY
CA_QRY_Debug_Print_All((STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3, _Str4);

QRY
CA_QRY_Debug_Print_All((STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4, (STRING)_Str5)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3, _Str4, _Str5);

QRY
CA_QRY_Debug_Print((CHARACTERGUID)_Player, (STRING)_Str1)
THEN
CA_Debug_Print(_Player, _Str1);

QRY
CA_QRY_Debug_Print((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2)
THEN
CA_Debug_Print(_Player, _Str1, _Str2);

QRY
CA_QRY_Debug_Print((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3);

QRY
CA_QRY_Debug_Print((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3, _Str4);

QRY
CA_QRY_Debug_Print((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4, (STRING)_Str5)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3, _Str4, _Str5);

PROC
CA_Debug_PrintAll((STRING)_Print)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Print, "", "", "", "");

PROC
CA_Debug_PrintAll((STRING)_Str1, (STRING)_Str2)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, "", "", "");

PROC
CA_Debug_PrintAll((STRING)_Str1, (STRING)_Str2, (STRING)_Str3)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3, "", "");

PROC
CA_Debug_PrintAll((STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3, _Str4, "");

PROC
CA_Debug_PrintAll((STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4, (STRING)_Str5)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3, _Str4, _Str5);

PROC
CA_Debug_Print((CHARACTERGUID)_Player, (STRING)_Message)
THEN
CA_Debug_Print(_Player, _Message, "", "", "", "");

PROC
CA_Debug_Print((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, "", "", "");

PROC
CA_Debug_Print((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3, "", "");

PROC
CA_Debug_Print((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4)
THEN
CA_Debug_Print(_Player, _Str1, _Str2, _Str3, _Str4, "");

PROC
CA_Debug_Print((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4, (STRING)_Str5)
AND
GlobalGetFlag("CA_DEBUG_DISPLAYMESSAGES", 1)
AND
StringConcatenate(_Str1, _Str2, _Msg1)
AND
StringConcatenate(_Msg1, _Str3, _Msg2)
AND
StringConcatenate(_Msg2, _Str4, _Msg3)
AND
StringConcatenate(_Msg3, _Str5, _Message)
THEN
CharacterStatusText(_Player, _Message);
//END_REGION

//REGION LOGGING
QRY
CA_Debug_QRY_Log_All((STRING)_Str1)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Str1);

QRY
CA_Debug_QRY_Log_All((STRING)_Str1, (STRING)_Str2)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Str1, _Str2);

QRY
CA_Debug_QRY_Log_All((STRING)_Str1, (STRING)_Str2, (STRING)_Str3)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3);

QRY
CA_Debug_QRY_Log_All((STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3, _Str4);

QRY
CA_Debug_QRY_Log_All((STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4, (STRING)_Str5)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3, _Str4, _Str5);

PROC
CA_Debug_LogAll((STRING)_Log)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Log, "", "", "", "");

PROC
CA_Debug_LogAll((STRING)_Str1, (STRING)_Str2)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, "", "", "");

PROC
CA_Debug_LogAll((STRING)_Str1, (STRING)_Str2, (STRING)_Str3)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3, "", "");

PROC
CA_Debug_LogAll((STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3, _Str4, "");

PROC
CA_Debug_LogAll((STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4, (STRING)_Str5)
AND
DB_IsPlayer(_Player)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3, _Str4, _Str5);

QRY
CA_Debug_QRY_Log((CHARACTERGUID)_Player, (STRING)_Str1)
THEN
CA_Debug_Log(_Player, _Str1);

QRY
CA_Debug_QRY_Log((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2)
THEN
CA_Debug_Log(_Player, _Str1, _Str2);

QRY
CA_Debug_QRY_Log((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3);

QRY
CA_Debug_QRY_Log((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3, _Str4);

QRY
CA_Debug_QRY_Log((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4, (STRING)_Str5)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3, _Str4, _Str5);

PROC
CA_Debug_Log((CHARACTERGUID)_Player, (STRING)_Message)
THEN
CA_Debug_Log(_Player, _Message, "", "", "", "");

PROC
CA_Debug_Log((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, "", "", "");

PROC
CA_Debug_Log((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3, "", "");

PROC
CA_Debug_Log((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4)
THEN
CA_Debug_Log(_Player, _Str1, _Str2, _Str3, _Str4, "");

PROC
CA_Debug_Log((CHARACTERGUID)_Player, (STRING)_Str1, (STRING)_Str2, (STRING)_Str3, (STRING)_Str4, (STRING)_Str5)
AND
GlobalGetFlag("CA_DEBUG_DISPLAYMESSAGES", 1)
AND
StringConcatenate(_Str1, _Str2, _Msg1)
AND
StringConcatenate(_Msg1, _Str3, _Msg2)
AND
StringConcatenate(_Msg2, _Str4, _Msg3)
AND
StringConcatenate(_Msg3, _Str5, _Msg4)
AND
CharacterGetDisplayName(_Player, _Handle, _Ref)
AND
StringConcatenate("CA|", _Ref, _MessagePrefix1)
AND
StringConcatenate(_MessagePrefix1, "|", _MessagePrefix)
AND
StringConcatenate(_MessagePrefix, _Msg4, _LoggedMessage)
THEN
SetVarFixedString(_Player, "CA_Debug_LogText", _LoggedMessage);
SetStoryEvent(_Player, "CA_Event_PlayerDebugLog");
//END_REGION

//REGION TESTLEVEL
IF
CharacterUsedItem(_Player, (ITEMGUID)ITEMGUID_BOOK_Book_CivilAuraSettings_000_53256d06-1f87-4ae7-98b3-618e560fba86)
THEN
UserSetFlag(_Player, "CA_USER_ISHOST");

IF
RegionStarted("CA_TestLevel")
THEN
DB_GLO_LVHub_Henchmen_Captain((CHARACTERGUID)CHARACTERGUID_Lizards_Hero_Female_000_f584adda-3587-444f-b0f2-965fd0f94319);
PROC_GLO_LVHub_Henchmen_Init();

IF
RegionStarted("CA_TestLevel")
AND
DB_IsPlayer(_Player)
THEN
UserSetFlag(_Player, "CA_USER_ISHOST");

IF
RegionStarted(_Region)
AND
_Region != "CA_TestLevel"
AND
DB_GLO_LVHub_Henchmen_Captain((CHARACTERGUID)CHARACTERGUID_Lizards_Hero_Female_000_f584adda-3587-444f-b0f2-965fd0f94319)
THEN
NOT DB_GLO_LVHub_Henchmen_Captain((CHARACTERGUID)CHARACTERGUID_Lizards_Hero_Female_000_f584adda-3587-444f-b0f2-965fd0f94319);
//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ZZZ_CivilAuras"
