Version 1
SubGoalCombiner SGC_AND
INITSECTION

KBSECTION
//REGION MIRROR_EXPLOIT
QRY
CA_PlayerInMirror((CHARACTERGUID)_Player)
AND
DB_Illusionist(_Player,_Mirror)
THEN
DB_NOOP(1);

//True if the player is not using the mirror
QRY
CA_SafeToChangeStats((CHARACTERGUID)_Player)
AND
NOT DB_Illusionist(_Player,_)
THEN
DB_NOOP(1);
//END_REGION

//REGION HELPER_METHODS
PROC
CA_PrintMessage((CHARACTERGUID)_Target, (STRING)_Prefix, (STRING)_Var, (STRING)_Suffix)
AND
StringConcatenate(_Prefix, _Var, _Str1)
AND
StringConcatenate(_Str1, _Suffix, _Str2)
THEN
CharacterStatusText(_Target, _Str2);

PROC
CA_PrintInt((CHARACTERGUID)_Target, (STRING)_Prefix, (INTEGER)_VarInt, (STRING)_Suffix)
AND
IntegertoString(_VarInt, _Var)
AND
StringConcatenate(_Prefix, _Var, _Str1)
AND
StringConcatenate(_Str1, _Suffix, _Str2)
THEN
CharacterStatusText(_Target, _Str2);

//END_REGION

//REGION BONUS_POINTS
IF
StoryEvent((CHARACTERGUID)_Player, "Event_CA_AddTalentPoint")
THEN
CharacterAddTalentPoint(_Player,1);

IF
StoryEvent((CHARACTERGUID)_Player, "Event_CA_AddAbilityPoint")
THEN
CharacterAddAbilityPoint(_Player, 1);

/*
IF
StoryEvent((CHARACTERGUID)_Player, "Event_CA_AddCivilPoint")
THEN
CharacterAddCivilAbilityPoint(_Player, 1);
*/

IF
StoryEvent((CHARACTERGUID)_Player, "Event_CA_AddAttributePoint")
THEN
CharacterAddAttributePoint(_Player, 1);

IF
StoryEvent((CHARACTERGUID)_Player, "Event_CA_AddSourcePoint")
THEN
CharacterAddSourcePoints(_Player, 1);
//END_REGION

//REGION DATABASE_REFRESH
PROC
CA_Global_ResetDatabases()
AND
DB_CA_ModVersion(_Version)
THEN
NOT DB_CA_ModVersion(_Version);

PROC
CA_Global_BuildSettings()
AND
DB_IsPlayer(_Player)
AND
NOT DB_CA_Settings_Barter_Messages(_Player, _, _, _)
THEN
DB_CA_Settings_Barter_Messages(_Player, 1, 100, 75);

//Add the mod version to fresh Origin saves, to avoid rebuilding.
IF
RegionStarted("TUT_Tutorial_A")
AND
NOT DB_CA_ModVersion("1.6.5")
THEN
DB_CA_ModVersion("1.6.5");
CA_Global_BuildSettings();

IF
CharacterCreationFinished(_Player)
AND
NOT DB_CA_ModVersion("1.6.5")
THEN
DB_CA_ModVersion("1.6.5");
CA_Global_BuildSettings();

//For refreshing existing saves
IF
SavegameLoaded(_,_,_,_)
AND
NOT DB_CA_ModVersion("1.6.5")
AND
DB_IsPlayer(_Player)
AND
NOT DB_CA_Refreshing(1)
THEN
CA_Global_ResetDatabases();
CA_Global_BuildSettings();
DB_CA_ModVersion("1.6.5");
DB_CA_Refreshing(1);
SetStoryEvent(_Player, "CA_Refresh");

IF
StoryEvent(_Object, "CA_Refresh")
AND
DB_CA_Refreshing(_Val)
THEN
NOT DB_CA_Refreshing(_Val);

//END_REGION
EXITSECTION

ENDEXITSECTION
ParentTargetEdge "ZZZ_CivilAuras"
